!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("Xethya",[],e):"object"==typeof exports?exports.Xethya=e():t.Xethya=e()}(this,function(){return function(t){var e={};function s(i){if(e[i])return e[i].exports;var r=e[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,s),r.l=!0,r.exports}return s.m=t,s.c=e,s.d=function(t,e,i){s.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:i})},s.r=function(t){Object.defineProperty(t,"__esModule",{value:!0})},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="",s(s.s="./src/xethya.ts")}({"./node_modules/eventemitter3/index.js":function(t,e,s){"use strict";var i=Object.prototype.hasOwnProperty,r="~";function n(){}function o(t,e,s,i,n){if("function"!=typeof s)throw new TypeError("The listener must be a function");var o=new function(t,e,s){this.fn=t,this.context=e,this.once=s||!1}(s,i||t,n),a=r?r+e:e;return t._events[a]?t._events[a].fn?t._events[a]=[t._events[a],o]:t._events[a].push(o):(t._events[a]=o,t._eventsCount++),t}function a(t,e){0==--t._eventsCount?t._events=new n:delete t._events[e]}function u(){this._events=new n,this._eventsCount=0}Object.create&&(n.prototype=Object.create(null),(new n).__proto__||(r=!1)),u.prototype.eventNames=function(){var t,e,s=[];if(0===this._eventsCount)return s;for(e in t=this._events)i.call(t,e)&&s.push(r?e.slice(1):e);return Object.getOwnPropertySymbols?s.concat(Object.getOwnPropertySymbols(t)):s},u.prototype.listeners=function(t){var e=r?r+t:t,s=this._events[e];if(!s)return[];if(s.fn)return[s.fn];for(var i=0,n=s.length,o=new Array(n);i<n;i++)o[i]=s[i].fn;return o},u.prototype.listenerCount=function(t){var e=r?r+t:t,s=this._events[e];return s?s.fn?1:s.length:0},u.prototype.emit=function(t,e,s,i,n,o){var a=r?r+t:t;if(!this._events[a])return!1;var u,l,c=this._events[a],d=arguments.length;if(c.fn){switch(c.once&&this.removeListener(t,c.fn,void 0,!0),d){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,e),!0;case 3:return c.fn.call(c.context,e,s),!0;case 4:return c.fn.call(c.context,e,s,i),!0;case 5:return c.fn.call(c.context,e,s,i,n),!0;case 6:return c.fn.call(c.context,e,s,i,n,o),!0}for(l=1,u=new Array(d-1);l<d;l++)u[l-1]=arguments[l];c.fn.apply(c.context,u)}else{var h,f=c.length;for(l=0;l<f;l++)switch(c[l].once&&this.removeListener(t,c[l].fn,void 0,!0),d){case 1:c[l].fn.call(c[l].context);break;case 2:c[l].fn.call(c[l].context,e);break;case 3:c[l].fn.call(c[l].context,e,s);break;case 4:c[l].fn.call(c[l].context,e,s,i);break;default:if(!u)for(h=1,u=new Array(d-1);h<d;h++)u[h-1]=arguments[h];c[l].fn.apply(c[l].context,u)}}return!0},u.prototype.on=function(t,e,s){return o(this,t,e,s,!1)},u.prototype.once=function(t,e,s){return o(this,t,e,s,!0)},u.prototype.removeListener=function(t,e,s,i){var n=r?r+t:t;if(!this._events[n])return this;if(!e)return a(this,n),this;var o=this._events[n];if(o.fn)o.fn!==e||i&&!o.once||s&&o.context!==s||a(this,n);else{for(var u=0,l=[],c=o.length;u<c;u++)(o[u].fn!==e||i&&!o[u].once||s&&o[u].context!==s)&&l.push(o[u]);l.length?this._events[n]=1===l.length?l[0]:l:a(this,n)}return this},u.prototype.removeAllListeners=function(t){var e;return t?(e=r?r+t:t,this._events[e]&&a(this,e)):(this._events=new n,this._eventsCount=0),this},u.prototype.off=u.prototype.removeListener,u.prototype.addListener=u.prototype.on,u.prefixed=r,u.EventEmitter=u,t.exports=u},"./src/base/eventable.ts":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("./node_modules/eventemitter3/index.js");e.default=class extends i.EventEmitter{constructor(){super()}}},"./src/base/object.ts":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("./src/base/eventable.ts"));e.default=class extends r.default{constructor(){super()}}},"./src/combat/abstract-combat-simulation.ts":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("./src/base/object.ts")),n=i(s("./src/combat/combat-turn.ts")),o=i(s("./src/combat/combat-round.ts"));e.default=class extends r.default{constructor({entities:t,roundRequestValidator:e,turnResolver:s=n.default,challengeResolver:i=(()=>!0)}){super(),this._ended=!1,this._entities=t,this._rounds=[],this._turnResolver=s,this._challengeResolver=i,this._roundRequestValidator=e}get entities(){return this._entities}get turnResolver(){return this._turnResolver}get challengeResolver(){return this._challengeResolver}get roundRequestValidator(){return this._roundRequestValidator}get rounds(){return this._rounds}get ended(){return this._ended}get currentRound(){return this._currentRound}challenge(){return this.challengeResolver.call(null,this)}begin(){this.challenge()?this._ended||(this.emit("before:combat"),this.beginRound()):this.end({avoided:!0})}canCombat(){return this.roundRequestValidator.call(null,this)}createRound(){const t=new o.default({entities:this._entities,roundNumber:this._rounds.length+1,turnType:this.turnResolver});return t.on("before:begin",this.onBeforeRoundBegin.bind(this)),t.on("begin",this.onRoundBegin.bind(this)),t.on("complete",this.onRoundComplete.bind(this)),t.on("turn",this.onRoundTurn.bind(this)),t}onBeforeRoundBegin({round:t}){this.emit("before:begin:round",{round:t})}onRoundBegin({round:t}){this.emit("begin:round",{round:t})}onRoundComplete({round:t}){this.emit("after:round",{round:t}),this.applyRoundResults(t)}onRoundTurn({turn:t}){this.emit("turn:round",{turn:t})}applyRoundResults(t){this._rounds.push(t),this.beginRound()}beginRound(){if(!this.canCombat())return void this.end();const t=this.createRound();t.begin(),this._currentRound=t}calculateResults(){return{avoided:!1}}end(t){if(this._ended=!0,t&&t.avoided)return void this.emit("end",{avoided:t.avoided});const e=this.calculateResults();return this.emit("end",{results:e}),e}}},"./src/combat/combat-round.ts":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("./src/interaction/round.ts")),n=s("./src/utils/group-by/group-by.ts");e.default=class extends r.default{constructor({entities:t,roundNumber:e,turnType:s}){super({entities:t,roundNumber:e,turnType:s}),this._turnType=s,this._entities=t,this._turns=[],this._entitiesByFaction=n.group(t,t=>t.faction.id)}get turnType(){return this._turnType}get turns(){return this._turns}get entities(){return this._entities}get currentTurn(){return this._currentTurn}buildTurnFor(t,e){const s=super.buildTurnFor(t,e);return s.validFoes=this.getValidFoesFor(t),s}getValidFoesFor(t){const e=[],{faction:s}=t,i=s.getEnemyFactions()||[],r=s.getNeutralFactions()||[];return i.concat(r).forEach(t=>{e.push(...this._entitiesByFaction[t.id])}),e}}},"./src/combat/combat-simulation.ts":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("./src/combat/abstract-combat-simulation.ts"));e.default=class extends r.default{}},"./src/combat/combat-turn.ts":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("./src/interaction/turn.ts"));e.default=class extends r.default{constructor(t){super(t),this._validFoes=t.validFoes||[]}get validFoes(){return this._validFoes}set validFoes(t){this._validFoes=t}}},"./src/dice/dice.ts":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("./src/random/randomizer.ts")),n=s("./src/random/blum-blum-shub.ts"),o=i(s("./src/base/object.ts")),a=i(s("./src/utils/assert/assert.ts"));class u extends o.default{constructor({faces:t=6,randomStrategy:e=n.BlumBlumShubAlgorithm,randomStrategySettings:s={}}={}){super(),this._faces=6,this.faces=t,this.setRandomStrategy(e,s),this._mustPreservePrng=e.recommendsToReinstantiate()}_regenerateRandomStrategyIfNeeded(){this._mustPreservePrng||this._initializeRandomizer()}_initializeRandomizer(){this._randomizer=new r.default(this.randomStrategy).create(this.randomStrategySettings)}roll(){this.emit("before:roll");const t=this._randomizer.generateRandom(),e=Math.ceil(t*this.faces);return this._regenerateRandomStrategyIfNeeded(),this.emit("roll",e),e}setRandomStrategy(t,e={}){this.randomStrategy=t,this.randomStrategySettings=e,this._initializeRandomizer()}get faces(){return this._faces}set faces(t){a.default(t>=2,"Dice#setFaces: a dice must have at least two faces"),this._faces=t}get randomStrategy(){return this._randomStrategy}set randomStrategy(t){this._randomStrategy=t}get randomStrategySettings(){return this._randomStrategySettings}set randomStrategySettings(t){this._randomStrategySettings=t}static rollD(t){return new u({faces:t}).roll()}}e.Dice=u},"./src/dice/presets/coin-flip.ts":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("./src/dice/dice.ts");e.CoinFlip=class extends i.Dice{constructor(){super({faces:2})}}},"./src/dice/throws/chance-throw-result.ts":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("./src/dice/throws/dice-throw-result.ts"));e.default=class extends r.default{constructor(t){super(),this.rolls=this.rolls.concat(t.rolls)}get throwType(){return this._throwType}set throwType(t){this._throwType=t}}},"./src/dice/throws/chance-throw.ts":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("./src/utils/range/range.ts")),n=s("./src/random/blum-blum-shub.ts"),o=s("./src/dice/throws/dice-throw.ts"),a=i(s("./src/dice/throws/chance-throw-result.ts"));e.ChanceThrow=class extends o.DiceThrow{constructor(t={randomStrategy:void 0}){super({numberOfDices:1,maxNumber:100,randomStrategy:t.randomStrategy||n.BlumBlumShubAlgorithm,randomStrategySettings:{seedNumber:Number(Math.random().toString().replace(/\./,""))}});const e={rollScores:{failure:new r.default(1,20),success:new r.default(21,90),criticalSuccess:new r.default(91,100)}};this.settings=Object.assign({},t,e)}_range(t){return this.settings.rollScores[t]}_calculateThrowType(t){for(let e of Object.keys(this.settings.rollScores))if(this._range(e).includes(t))return e}roll(){const t=super.roll(),e=new a.default(t),s=t.getRollSum();return e.throwType=this._calculateThrowType(s),e}}},"./src/dice/throws/dice-throw-result.ts":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default=class{constructor(){this.rolls=[]}getRollSum(){return this.rolls.reduce((t,e)=>t+e)}}},"./src/dice/throws/dice-throw.ts":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s("./src/dice/dice.ts"),n=i(s("./src/dice/throws/dice-throw-result.ts")),o=s("./src/random/blum-blum-shub.ts"),a=i(s("./src/utils/assert/assert.ts"));e.DiceThrow=class{constructor({numberOfDices:t=2,maxNumber:e=6,randomStrategy:s=o.BlumBlumShubAlgorithm,randomStrategySettings:i={}}={}){a.default(e>=2,"DiceThrow#constructor: expected `maxNumber` to be at least 2."),this.dices=[];for(let n=0;n<t;n+=1)this.dices.push(new r.Dice({faces:e,randomStrategy:s,randomStrategySettings:i}))}roll(){let t=new n.default;return t.rolls=this.dices.map(t=>t.roll()),t}}},"./src/dice/throws/skill-throw-result.ts":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("./src/dice/throws/chance-throw-result.ts"));e.SkillThrowResult=class extends r.default{constructor({skillValue:t,skillAttributesModifierValue:e,throwResult:s}){super(s),this._skillValue=t,this._skillAttributeModifiersValue=e}get skillValue(){return this._skillValue}get skillAttributeModifiersValue(){return this._skillAttributeModifiersValue}get totalRollValue(){return this.skillValue+this.getRollSum()+this.skillAttributeModifiersValue}get failureRoll(){return this._failureRoll}set failureRoll(t){this._failureRoll=t}}},"./src/dice/throws/skill-throw.ts":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("./src/dice/throws/chance-throw.ts"),r=s("./src/dice/throws/skill-throw-result.ts");e.default=class extends i.ChanceThrow{constructor(t){super(),this._skill=t}get skill(){return this._skill}roll(){const t=super.roll();return new r.SkillThrowResult({skillValue:this._skill.value,skillAttributesModifierValue:this._skill.modifiers.getSum(),throwResult:t})}}},"./src/entity/able-entity.ts":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("./src/entity/entity.ts")),n=i(s("./src/entity/skills/skill-collection.ts"));e.AbleEntity=class extends r.default{constructor(t){super(t),this._skills=n.default.fromArray(t.skills)}get skills(){return this._skills}}},"./src/entity/abstract-entity.ts":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("./src/base/object.ts")),n=i(s("./src/entity/attributes/attribute-collection.ts")),o=i(s("./src/entity/modifiers/modifier-collection.ts"));e.AbstractEntity=class extends r.default{constructor({id:t,name:e="UnnamedEntity",volatile:s=!1,attributes:i=[],modifiers:r=[]}={}){super(),this._id=t,this._name=e,this._volatile=s,this._attributes=n.default.fromArray(i),this._modifiers=o.default.fromArray(r)}get id(){return this._id}get name(){return this._name}set name(t){this._name=t}get volatile(){return this._volatile}get attributes(){return this._attributes}get modifiers(){return this._modifiers}}},"./src/entity/attributes/attribute-collection.ts":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("./src/utils/collection/collection.ts"));class n extends r.default{constructor(){super("id")}add(...t){t.forEach(this._bindAttributeEvents.bind(this)),super.add(...t)}remove(t){this._unbindAttributeEvents(t),super.remove(t)}removeAll(){this.getAll().forEach(t=>this.remove(t.id))}setValue(t,e){if(this.contains(t)){this.get(t).rawValue=e}}getModifierSumForAll(){return 0===this.count?0:this.getAll().map(t=>t.modifiers.getSum()).reduce((t,e)=>t+e)}_bindAttributeEvents(t){t.on("change:value",(...e)=>{this.emit("change:attribute:value",...e),this.emit(`change:attribute:${t.id}:value`,...e)})}_unbindAttributeEvents(t){this.off(`change:attribute:${t}:value`)}static fromArray(t){const e=new n;return e.add(...t),e}}e.default=n},"./src/entity/attributes/attribute.ts":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("./src/utils/assert/assert.ts")),n=i(s("./src/base/eventable.ts")),o=i(s("./src/entity/modifiers/base-modifier.ts")),a=i(s("./src/entity/modifiers/modifier-collection.ts"));e.Attribute=class extends n.default{constructor({id:t,initialValue:e=0,valueRange:s}){super(),this._rawValue=0,this._id="",this.modifiers=new a.default,this.id=t,this._rawValue=e,s&&(this._valueRange=s),this.modifiers.add(new o.default),this._updateBaseModifierValue()}_updateBaseModifierValue(){this.modifiers.setValue("base",this._rawValue)}get id(){return this._id}set id(t){r.default(""!==t,"Attribute#set[id]: cannot be an empty String"),this._id=t}get rawValue(){return this._rawValue}set rawValue(t){const e=this._valueRange;e&&r.default(e.includes(t),`Attribute#set[value]: value is out of range (must be within ${e.toString()})`);const s=this._rawValue;s!==t&&(this.emit("before:change:value",{previousValue:s,newValue:t}),this._rawValue=t,this._updateBaseModifierValue(),this.emit("change:value",this))}get value(){return this.rawValue+this.modifiers.getSum()}get baseModifierValue(){return this.modifiers.get("base").value}toString(){const t=this.modifiers.getSum(),e=t>=0?"+":"";return`${this.rawValue.toString()} (${e}${t.toString()})`}}},"./src/entity/entity.ts":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("./src/entity/abstract-entity.ts");e.default=class extends i.AbstractEntity{constructor(t){super(t)}}},"./src/entity/living-entity.ts":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s("./src/entity/able-entity.ts"),n=i(s("./src/entity/modifiers/modifier.ts")),o=i(s("./src/entity/stats/stat-collection.ts"));e.LivingEntity=class extends r.AbleEntity{constructor(t){super(t),this._race=t.race,this._age=t.age,this._weight=t.weight,this._height=t.height,this._faction=t.faction,this._stats=o.default.fromArray(t.stats),this._applyRacialTraits()}get stats(){return this._stats}get race(){return this._race}get age(){return this._age}get height(){return this._height}get weight(){return this._weight}get faction(){return this._faction}_applyRacialTraits(){this._applyRaceAttributes(),this._applyRaceStats(),this._applyRaceSkills()}_applyRaceAttributes(){this._race.attributes.getAll().forEach(t=>{const e=new n.default(`${t.id}RaceTrait`,t.rawValue);this.attributes.get(t.id).modifiers.add(e)})}_applyRaceStats(){this.race.stats.getAll().forEach(t=>{const e=new n.default(`${t.id}RaceTrait`,t.value);this.stats.get(t.id).modifiers.add(e)})}_applyRaceSkills(){this.race.skills.getAll().forEach(t=>{const e=new n.default(`${t.id}RaceTrait`,t.value);this.skills.get(t.id).modifiers.add(e)})}}},"./src/entity/modifiers/base-modifier-calculator.ts":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.BaseModifierCalculator=function(t){return Math.floor((t-10)/2)}},"./src/entity/modifiers/base-modifier.ts":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("./src/entity/modifiers/modifier.ts")),n=s("./src/entity/modifiers/base-modifier-calculator.ts");e.default=class extends r.default{constructor(t=n.BaseModifierCalculator){super("base"),this._calculateValue=n.BaseModifierCalculator,this._calculateValue=t}get value(){return super.value}set value(t){super.value=this._calculateValue(t)}}},"./src/entity/modifiers/modifier-collection.ts":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("./src/utils/collection/collection.ts"));class n extends r.default{constructor(){super("id")}add(...t){t.forEach(this._bindModifierEvents.bind(this)),super.add(...t)}remove(t){this._unbindModifierEvents(t),super.remove(t)}removeAll(){this.getAll().forEach(t=>this.remove(t.id))}setValue(t,e){if(this.contains(t)){this.get(t).value=e}}activate(t){if(this.contains(t)){this.get(t).active=!0}}deactivate(t){if(this.contains(t)){this.get(t).active=!1}}getSum(){return 0===this.count?0:this.where(t=>t.active).map(t=>t.value).reduce((t,e)=>t+e)}_bindModifierEvents(t){t.on("change:value",(...e)=>{this.emit("change:modifier:value",...e),this.emit(`change:modifier:${t.id}:value`,...e)}),t.on("change:active",(...e)=>{this.emit("change:modifier:active",...e),this.emit(`change:modifier:${t.id}:active`,...e)}),t.on("activate",(...e)=>{this.emit("activate:modifier",...e),this.emit(`activate:modifier:${t.id}`,...e)}),t.on("deactivate",(...e)=>{this.emit("deactivate:modifier",...e),this.emit(`deactivate:modifier:${t.id}`,...e)})}_unbindModifierEvents(t){this.off(`change:modifier:${t}:value`),this.off(`change:modifier:${t}:active`),this.off(`activate:modifier:${t}`),this.off(`deactivate:modifier:${t}`)}static fromArray(t){const e=new n;return e.add(...t),e}}e.default=n},"./src/entity/modifiers/modifier.ts":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("./src/utils/assert/assert.ts")),n=i(s("./src/base/eventable.ts"));e.default=class extends n.default{constructor(t,e=0,s){super(),this._id="",this._value=0,this._active=!0,this.id=t,this.source=s,this._value=e}get id(){return this._id}set id(t){r.default(""!==t,"Modifier#set[id]: cannot be an empty String"),this._id=t}get active(){return this._active}set active(t){this._active!==t&&(this._active=t,this.emit(t?"activate":"deactivate",this),this.emit("change:active",this))}get value(){return this._value}set value(t){if(this._value!==t){const e=this._value;this.emit("before:change:value",{previousValue:e,newValue:t}),this._value=t,this.emit("change:value",this)}}get source(){return this._source}set source(t){this._source=t}}},"./src/entity/race/race.ts":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("./src/base/object.ts")),n=i(s("./src/entity/attributes/attribute-collection.ts")),o=i(s("./src/entity/skills/skill-collection.ts")),a=i(s("./src/entity/stats/stat-collection.ts")),u=i(s("./src/utils/range/range.ts"));e.Race=class extends r.default{constructor({id:t,name:e="Unnamed Race",lifeExpectancy:s=u.default.fromArray([90,100]),defaultAlignment:i="neutral:neutral",heightRange:r=u.default.fromArray([165,185]),heritageAttributes:l=[],heritageSkills:c=[],heritageStats:d=[]}){super(),this.id=t,this.name=e,this.attributes=n.default.fromArray(l),this.skills=o.default.fromArray(c),this.stats=a.default.fromArray(d),this.lifeExpectancy=s,this.defaultAlignment=i,this.heightRange=r}}},"./src/entity/skills/skill-collection.ts":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("./src/utils/collection/collection.ts")),n=i(s("./src/utils/assert/assert.ts"));class o extends r.default{constructor(){super("id")}add(...t){t.forEach(t=>this._bindSkillEvents.bind(this)),super.add(...t)}remove(t){this._unbindSkillEvents(t),super.remove(t)}removeAll(){this.getAll().forEach(t=>this.remove(t.id))}useSkill(t){return n.default(this.contains(t),"SkillCollection#useSkill: skill does not exist"),this.get(t).use()}_bindSkillEvents(t){t.on("before:use",(...e)=>{this.emit("before:use:skill",...e),this.emit(`before:use:skill:${t.id}`,...e)}),t.on("use",(...e)=>{this.emit("use:skill",...e),this.emit(`use:skill:${t.id}`,...e)})}_unbindSkillEvents(t){this.off(`before:use:skill:${t}`),this.off(`use:skill:${t}`)}static fromArray(t){const e=new o;return e.add(...t),e}}e.default=o},"./src/entity/skills/skill.ts":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("./src/entity/attributes/attribute-collection.ts")),n=i(s("./src/entity/modifiers/modifier-collection.ts")),o=i(s("./src/base/object.ts")),a=i(s("./src/utils/assert/assert.ts")),u=i(s("./src/dice/throws/skill-throw.ts")),l=s("./src/dice/throws/chance-throw.ts");e.Skill=class extends o.default{constructor({id:t,owner:e,attributes:s=[],modifiers:i=[],primaryAttribute:o=""}){super(),this._id=t,this.attributes=r.default.fromArray(s),this.modifiers=n.default.fromArray(i),this.attributes.count>0&&this._setPrimaryAttribute(o)}_setPrimaryAttribute(t){const e="string"==typeof t?t:t.id;a.default(this.attributes.contains(e),"Skill#constructor: primaryAttribute must be defined in attributes array"),this._primaryAttribute=this.attributes.get(e)}get primaryAttribute(){return this._primaryAttribute}set primaryAttribute(t){this._primaryAttribute=t}get id(){return this._id}get value(){return this._primaryAttribute.value}use(){this.emit("before:use",this);const t=new u.default(this).roll();return"failure"===t.throwType&&(t.failureRoll=(new l.ChanceThrow).roll()),this.emit("use",this),t}}},"./src/entity/stats/stat-collection.ts":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("./src/utils/collection/collection.ts"));class n extends r.default{constructor(){super("id")}add(...t){t.forEach(t=>this._bindStatEvents.bind(this)),super.add(...t)}remove(t){this._unbindStatEvents(t),super.remove(t)}removeAll(){this.getAll().forEach(t=>this.remove(t.id))}_bindStatEvents(t){t.on("change:value",(...e)=>{this.emit("change:stat:value",...e),this.emit(`change:stat:${t.id}:value`,...e)})}_unbindStatEvents(t){this.off(`change:stat:${t}:value`)}static fromArray(t){const e=new n;return e.add(...t),e}}e.default=n},"./src/entity/stats/stat.ts":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s("./src/entity/attributes/attribute.ts"),n=i(s("./src/entity/attributes/attribute-collection.ts"));e.default=class extends r.Attribute{constructor(t,e){super({id:t}),this._lastCalculatedValue=0,this.attributes=new n.default,this.modifiers.remove("base"),this._calculateStat=e,this.attributes.on("change:attribute:value",this._valueChanged.bind(this))}_valueChanged(){this.emit("change:value",{previousValue:this._lastCalculatedValue,newValue:this.value})}get value(){const t=this._calculateStat(this);return this._lastCalculatedValue!==t&&(this.emit("change:value",{previousValue:this._lastCalculatedValue,newValue:t}),this._lastCalculatedValue=t),t}}},"./src/interaction/abstract-round.ts":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("./src/base/object.ts")),n=i(s("./src/interaction/turn-resolver.ts"));e.default=class extends r.default{constructor({entities:t,roundNumber:e,turnType:s}){super(),this._roundNumber=e,this._turnType=s,this._entities=t,this._turns=[]}get roundNumber(){return this._roundNumber}get turnType(){return this._turnType}get entities(){return this._entities}get turns(){return this._turns}get currentTurn(){return this._currentTurn}buildTurns(){this._entities.forEach((t,e)=>{const s=this.buildTurnFor(t,e+1);this._turns.push(s)})}buildTurnFor(t,e){const s=new n.default(this.turnType).create({owner:t,turnNumber:e});return s.on("begin",this.onTurnBegin.bind(this)),s.on("end",this.onTurnEnd.bind(this)),s}onTurnBegin({turn:t}){this.emit("turn",{turn:t})}onTurnEnd({turn:t}){this.updateTurn(t)}begin(){this.emit("before:begin",{round:this}),this.buildTurns(),this.announceTurn(),this.emit("begin",{round:this})}announceTurn(){const t=this._turns.find(t=>!t.isResolved());this._currentTurn=t,t.begin()}updateTurn(t){const e=t.turnNumber-1;this._turns[e].action=t.action,this.checkIfRoundIsComplete()}checkIfRoundIsComplete(){this._turns.every(t=>t.isResolved())?this.emit("complete",{round:this}):this.announceTurn()}}},"./src/interaction/abstract-turn.ts":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("./node_modules/eventemitter3/index.js");e.default=class extends i.EventEmitter{constructor({turnNumber:t,owner:e}){super(),this._turnNumber=t,this._owner=e}isResolved(){return null!==this._action&&void 0!==this._action}get turnNumber(){return this._turnNumber}get owner(){return this._owner}get action(){return this._action}set action(t){this._action=t}begin(){this.emit("begin",{turn:this})}end(){this.emit("end",{turn:this})}resolve(t){this._action=t}}},"./src/interaction/round.ts":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("./src/interaction/abstract-round.ts"));e.default=class extends r.default{}},"./src/interaction/turn-resolver.ts":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default=class{constructor(t){this.constructorFunction=t}create(t){return new this.constructorFunction(t)}}},"./src/interaction/turn.ts":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("./src/interaction/abstract-turn.ts"));e.default=class extends r.default{}},"./src/random/blum-blum-shub.ts":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.P=87566873,e.Q=5631179,e.DefaultSeeds=[193945,740191,191];class i{constructor(t){this.settings=t;const s={p:e.P,q:e.Q,seedNumber:null};this.settings=Object.assign({},s,t);let i=this.settings.seedNumber;const r=this.settings.p,n=this.settings.q;i=i?Math.abs(i):e.DefaultSeeds[Math.floor(Math.random()*e.DefaultSeeds.length)],this.seedNumber=i,this.randomIndex=i,this.M=r*n,this.P=r,this.Q=n}static recommendsToReinstantiate(){return!0}recommendsToReinstantiate(){return i.recommendsToReinstantiate()}generateRandom(){const t=this.randomIndex*this.randomIndex%this.M;return this.randomIndex=t,Math.abs(t/this.M)}generateRandomInteger(){return Number(this.generateRandom().toString().replace(/\./,""))}}e.BlumBlumShubAlgorithm=i},"./src/random/mersenne-twister.ts":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("./src/utils/assert/assert.ts"));e.N=624,e.M=397,e.MATRIX_A=2567483615,e.UPPER_MASK=2147483648,e.LOWER_MASK=2147483647,e.INIT_BY_ARRAY_SEED=19650218;class n{constructor(t){let s;this.settings=t;const i={seedNumber:void 0};this.settings=Object.assign({},i,t);const r=this.settings.seedNumber;s=r?Math.abs(r):Number((new Date).getTime().toString().split("").sort(()=>.5-Math.random()).join("")),this.MT=new Array(e.N),this.MTI=e.N+1,this.seedNumber=s,this.initializeRandomGenerator(s)}static recommendsToReinstantiate(){return!1}recommendsToReinstantiate(){return n.recommendsToReinstantiate()}initializeRandomGenerator(t){let s=Math.abs(Math.floor(t));for(this.MT[0]=s>>0,this.MTI=1;this.MTI<e.N;this.MTI+=1)s=this.MT[this.MTI-1]^this.MT[this.MTI-1]>>30,this.MT[this.MTI]=(1812433253*((4294901760&s)>>16)<<16)+1812433253*(65535&s)+this.MTI,this.MT[this.MTI]=this.MT[this.MTI]>>0}initializeByArray(t){let s=1,i=0;const n=t.length;r.default(n>0,"MersenneTwister#initializeByArray: initKeyArray must be an Array of at least one non-negative number.");const o=t.map(t=>Math.abs(Math.floor(t)));this.initializeRandomGenerator(e.INIT_BY_ARRAY_SEED);let a=e.N>n?e.N:n;for(;a>0;){const t=this.MT[s-1]^this.MT[s-1]>>30;this.MT[s]=(this.MT[s]^(1664525*((4294901760&t)>>16)<<16)+1664525*(65535&t))+o[i]+i,this.MT[s]=this.MT[s]>>0,i+=1,(s+=1)>=e.N&&(this.MT[0]=this.MT[e.N-1],s=1),i>=n&&(i=0),a-=1}for(a=e.N-1;a>0;a-=1){const t=this.MT[s-1]^this.MT[s-1]>>30;this.MT[s]=(this.MT[s]^(1566083941*((4294901760&t)>>16)<<16)+1566083941*(65535&t))-s,this.MT[s]=this.MT[s]>>0,(s+=1)>=e.N&&(this.MT[0]=this.MT[e.N-1],s=1)}this.MT[0]=2147483648}generateRandomInteger(){let t;const s=[0,e.MATRIX_A];if(this.MTI>=e.N){let i;for(this.MTI===e.N+1&&this.initializeRandomGenerator(5489),i=0;i<e.N-e.M;i+=1)t=this.MT[i]&e.UPPER_MASK|this.MT[i+1]&e.LOWER_MASK,this.MT[i]=this.MT[i+e.M]^t>>1^s[1&t];for(;i<e.N-1;)t=this.MT[i]&e.UPPER_MASK|this.MT[i+1]&e.LOWER_MASK,this.MT[i]=this.MT[i+e.M-e.N]^t>>1^s[1&t],i+=1;t=this.MT[e.N-1]&e.UPPER_MASK|this.MT[0]&e.LOWER_MASK,this.MT[e.N-1]=this.MT[e.M-1]^t>>1^s[1&t],this.MTI=0}return this.MTI+=1,t=this.MT[this.MTI],t^=t>>11,t^=t<<7&2636928640,t^=t<<15&4022730752,(t^=t>>18)>>0}generateRandomInteger31(){return this.generateRandomInteger()>>1}generateRandomReal(){return this.generateRandomInteger()*(1/4294967295)}generateRandom(){return this.generateRandomInteger()*(1/4294967296)}generateRandomReal3(){return(this.generateRandomInteger()+.5)*(1/4294967296)}generateRandomReal53BitResolution(){return(671084464*(this.generateRandomInteger()>>5)+(this.generateRandomInteger()>>6))*(1/9007199254740992)}}e.MersenneTwisterAlgorithm=n},"./src/random/randomizer.ts":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default=class{constructor(t){this.constructorFunction=t}create(t){return new this.constructorFunction(t)}}},"./src/relationships/abstract-faction.ts":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("./src/utils/group-by/group-by.ts");e.default=class{constructor({id:t,name:e}){this._id=t,this._name=e,this._allRelationships=[],this._relationshipsByStatus={}}get id(){return this._id}get name(){return this._name}get allRelationships(){return this._allRelationships}set allRelationships(t){this._allRelationships=t,this._relationshipsByStatus=this.groupRelationshipsByStatus()}get relationshipsByStatus(){return this._relationshipsByStatus}groupRelationshipsByStatus(){return i.groupAndMap(this._allRelationships,t=>t.relationshipStatus,t=>t.faction)}getAlliedFactions(){return this._relationshipsByStatus.ally}getNeutralFactions(){return this._relationshipsByStatus.neutral}getEnemyFactions(){return this._relationshipsByStatus.enemy}addRelationship(t,e){const s={faction:t,relationshipStatus:e};this._allRelationships.push(s),this._relationshipsByStatus=this.groupRelationshipsByStatus()}addAlliedRelationship(t){this.addRelationship(t,"ally")}addNeutralRelationship(t){this.addRelationship(t,"neutral")}addEnemyRelationship(t){this.addRelationship(t,"enemy")}}},"./src/relationships/faction.ts":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("./src/relationships/abstract-faction.ts"));e.default=class extends r.default{}},"./src/utils/assert/assert.ts":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("./src/utils/assert/assertion-error.ts"));e.default=function(t,e){if(!t)throw new r.default(e)}},"./src/utils/assert/assertion-error.ts":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default=class extends Error{constructor(t){super(),this.message=`[AssertionError] An assertion has failed${t?": "+t:""}`}}},"./src/utils/collection/abstract-collection.ts":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("./src/base/eventable.ts")),n=i(s("./src/utils/assert/assert.ts"));e.default=class extends r.default{constructor(t){super(),this._list={},this.indexName=t}get count(){return this.getAllKeys().length}get(t){return this._list[t]}getAll(){return this.getAllKeys().map(t=>this._list[t])}getAllKeys(){return Object.keys(this._list)}where(t){return this.getAll().filter(t)}contains(t){return t in this._list}add(...t){this.emit("before:add",this,...t),t.forEach(t=>{const e=t[this.indexName];n.default(!this.contains(e),`An item already exists with key: ${e}`),this._list[e]=t}),this.emit("add",this)}remove(t){this.contains(t)&&(this.emit("before:remove",this),delete this._list[t],this.emit("remove"))}removeAll(){this.emit("before:removeAll",this),this._list={},this.emit("removeAll",this)}}},"./src/utils/collection/collection.ts":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("./src/utils/collection/abstract-collection.ts"));class n extends r.default{constructor(t){super(t),this.indexName=t}static fromArrayOf(t,e){const s=new n(e);return s.add(...t),s}}e.default=n},"./src/utils/group-by/group-by.ts":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.group=function(t,e){const s={};return t.forEach(t=>{const i=e(t);i in s?s[i].push(t):s[i]=[t]}),s},e.groupAndMap=function(t,e,s){const i={};return t.forEach(t=>{const r=e(t);r in i?i[r].push(s(t)):i[r]=[s(t)]}),i}},"./src/utils/range/range.ts":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("./src/utils/assert/assert.ts"));class n{constructor(t,e){r.default(t!==e,"Range#constructor: lowerBound and upperBound cannot be equal"),this.lowerBound=Math.min(t,e),this.upperBound=Math.max(t,e)}includes(t){return this.lowerBound<=t&&t<=this.upperBound}toString(){return`${this.lowerBound.toString()} ~ ${this.upperBound.toString()}`}static fromArray(t){return r.default(2===t.length,"Range#fromArray: values must be an Array of 2 numerical elements"),new n(t[0],t[1])}static fromNotation(t){const e="Range#fromNotation: notedRange must use one of these formats: x,y x;y x:y x~y";let s;r.default(void 0!==t,e),r.default("string"==typeof t,e);const i=[",",";",":","~"];r.default(i.some(e=>t.includes(e)),e);let o=!1;for(;!o;){const a=i.shift();if(o=t.includes(a)){const i=t.split(a).map(t=>t.trim());r.default(2===i.length,e),s=n.fromArray(i.map(t=>Number(t)))}}return s}}e.default=n},"./src/utils/shuffle/shuffle.ts":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("./src/utils/collection/collection.ts")),n=s("./src/random/blum-blum-shub.ts"),o=t=>{const e=new n.BlumBlumShubAlgorithm;return t.map(t=>({element:t,shuffleIndex:e.generateRandom()})).sort((t,e)=>t.shuffleIndex<e.shuffleIndex?1:t.shuffleIndex>e.shuffleIndex?-1:0).map(t=>t.element)};e.shuffleArray=o;e.shuffleCollection=(t=>{const e=new r.default(t.indexName);return e.add(...o(t.getAll())),e})},"./src/xethya.ts":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}},r=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var s in t)Object.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e.default=t,e};Object.defineProperty(e,"__esModule",{value:!0});const n=i(s("./src/base/eventable.ts")),o=i(s("./src/base/object.ts")),a={Eventable:n.default,XethyaObject:o.default};e.Base=a;const u=i(s("./src/utils/assert/assert.ts")),l=i(s("./src/utils/range/range.ts")),c=i(s("./src/utils/collection/abstract-collection.ts")),d=i(s("./src/utils/collection/collection.ts")),h=s("./src/utils/group-by/group-by.ts"),f=s("./src/utils/shuffle/shuffle.ts"),_={assert:u.default,Range:l.default,AbstractCollection:c.default,Collection:d.default,group:h.group,groupAndMap:h.groupAndMap,shuffleArray:f.shuffleArray,shuffleCollection:f.shuffleCollection};e.Utils=_;const m={BlumBlumShub:r(s("./src/random/blum-blum-shub.ts")),MersenneTwister:r(s("./src/random/mersenne-twister.ts")),Randomizer:i(s("./src/random/randomizer.ts")).default};e.Random=m;const b=s("./src/dice/dice.ts"),p=s("./src/dice/throws/dice-throw.ts"),g=s("./src/dice/throws/chance-throw.ts"),v=i(s("./src/dice/throws/chance-throw-result.ts")),y=i(s("./src/dice/throws/skill-throw.ts")),M=s("./src/dice/throws/skill-throw-result.ts"),R=s("./src/dice/presets/coin-flip.ts"),w={Dice:b.Dice,DiceThrow:p.DiceThrow,ChanceThrow:g.ChanceThrow,ChanceThrowResult:v.default,SkillThrow:y.default,SkillThrowResult:M.SkillThrowResult,Presets:{CoinFlip:R.CoinFlip}};e.Dices=w;const T=s("./src/entity/abstract-entity.ts"),A=i(s("./src/entity/entity.ts")),S=s("./src/entity/able-entity.ts"),x=s("./src/entity/living-entity.ts"),k=s("./src/entity/race/race.ts"),j=i(s("./src/entity/modifiers/modifier.ts")),E=i(s("./src/entity/modifiers/base-modifier.ts")),O=s("./src/entity/modifiers/base-modifier-calculator.ts"),P=i(s("./src/entity/modifiers/modifier-collection.ts")),N=s("./src/entity/attributes/attribute.ts"),B=i(s("./src/entity/attributes/attribute-collection.ts")),V=i(s("./src/entity/stats/stat.ts")),D=i(s("./src/entity/stats/stat-collection.ts")),C=s("./src/entity/skills/skill.ts"),I=i(s("./src/entity/skills/skill-collection.ts")),F={AbstractEntity:T.AbstractEntity,Entity:A.default,AbleEntity:S.AbleEntity,LivingEntity:x.LivingEntity,Race:k.Race,Modifier:j.default,BaseModifierCalculator:O.BaseModifierCalculator,BaseModifier:E.default,ModifierCollection:P.default,Attribute:N.Attribute,AttributeCollection:B.default,Stat:V.default,StatCollection:D.default,Skill:C.Skill,SkillCollection:I.default};e.Entities=F;const $=i(s("./src/relationships/abstract-faction.ts")),z=i(s("./src/relationships/faction.ts")),L={Factions:{AbstractFaction:$.default,Faction:z.default}};e.Relationships=L;const K=i(s("./src/interaction/turn-resolver.ts")),q=i(s("./src/interaction/abstract-turn.ts")),U=i(s("./src/interaction/turn.ts")),X=i(s("./src/interaction/abstract-round.ts")),G=i(s("./src/interaction/round.ts")),W=i(s("./src/combat/combat-turn.ts")),Y=i(s("./src/combat/combat-round.ts")),Q=i(s("./src/combat/abstract-combat-simulation.ts")),H=i(s("./src/combat/combat-simulation.ts")),J={TurnResolver:K.default,AbstractTurn:q.default,Turn:U.default,AbstractRound:X.default,Round:G.default,Combat:{CombatTurn:W.default,CombatRound:Y.default,AbstractCombatSimulation:Q.default,CombatSimulation:H.default}};e.Interactions=J}})});
//# sourceMappingURL=xethya.js.map